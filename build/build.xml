<?xml version="1.0" encoding="UTF-8"?>
<project name="motech-whp" basedir=".">

    <taskdef resource="net/sf/antcontrib/antcontrib.properties">
        <classpath>
            <pathelement location="lib/ant-contrib-1.0b3.jar"/>
        </classpath>
    </taskdef>

    <taskdef name="for" classname="net.sf.antcontrib.logic.ForTask">
        <classpath>
            <pathelement location="lib/ant-contrib-1.0b3.jar"/>
        </classpath>
    </taskdef>

    <property file="${basedir}\build.properties"/>
    <property file="${basedir}\maven.properties"/>

    <path id="lib.path">
        <fileset dir="../whp-web/target/whp-web-0.1-SNAPSHOT/WEB-INF/lib" includes="**/*.jar"/>
    </path>

    <target name="load.seed.data">
        <echo message="Loading Seed Data.."/>
        <java fork="false" classname="org.motechproject.deliverytools.seed.SetupSeedData">
            <classpath>
                <path location="../whp-web/target/whp-web-0.1-SNAPSHOT/WEB-INF/classes"/>
                <path refid="lib.path"/>
            </classpath>
        </java>
    </target>
    <target name="load.patient.data.from.csv">
        <dataImporter importerType="patient"/>
    </target>
    <target name="load.provider.data.from.csv">
       <dataImporter importerType="provider"/>
    </target>

    <macrodef name="dataImporter">
        <attribute name="importerType"/>
       <sequential>
           <fail unless="@{importerType}File" message="Usage : ant load.@{importerType}.data.from.csv -D@{importerType}File=path -DimporterLog=path" />
           <echo message="Loading @{importerType} Data..."/>
           <condition property="importerLog" value="dataImporter.log">
               <not>
                   <isset property="importerLog"/>
               </not>
           </condition>
           <java fork="false" classname="org.motechproject.whp.importer.csv.CsvImporter" output="${importerLog}" append="true">
               <arg value="@{importerType}"/>
               <arg value="${@{importerType}File}"/>
               <classpath>
                   <path location="../whp-data-importer/target/whp-data-importer-0.1-SNAPSHOT.jar"/>
                   <path refid="lib.path"/>
               </classpath>
           </java>
           <echo message="Output log is stored in ${importerLog}"/>
       </sequential>
    </macrodef>

    <target name="drop.all.dbs">
        <for list="motech-whp,motech-web-security,motech-tb-adherence"
             param="db.name">
            <sequential>
                <exec executable="curl">
                    <arg value="-s"/>
                    <arg value="-S"/>
                    <arg value="-X"/>
                    <arg value="DELETE"/>
                    <arg value="http://${couchdb.server}:${couchdb.port}/@{db.name}"/>
                </exec>
            </sequential>
        </for>
    </target>

</project>

